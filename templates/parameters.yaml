# TODO: figure out why I am getting missing : errors with the way configs are blocked at app levels

Defaults:
  docker_version: 3.7
  tag: latest
  networks:
    frontend: false
    vpn: false
  PUID: 1001
  PGID: 1001
  'Time Zone': America/Los_Angeles
  'Container Home': /nobody
  Email: dresdale.jacob@gmail.com
  Domain: expectedbehaviors.com
  'Log Level': 1
Globals:
  Networks:
    - Backend
    - Frontend
    - Backend_VPN
  Paths:
    Profile: ~/.bashrc
    SSH: ~/.ssh
    Cleanup:
      - .idea
    Scripts:
      - rebuild-symlinks
      - docker_prune
      - rebuild-docker-stacks
  Exports:
    HOME: /home/batman
    CONFIGS: /var/data/configs
    CONFIG: /var/data/configs
    SCRIPTS: /var/data/scripts
    SECRETS: /var/lib/docker/config/secrets
    LOGS: /var/data/logs
    LOG: /var/data/logs
    DOCKER: /var/lib/docker/config
  Keys:
    SSH:
      - personal_git_rsa
'Stack Group Name':
  Docker:
    Volumes:
      - portainer
      - organizr
    Services:
      docker-cleanup:
        mode: global
        Image: meltwater/docker-cleanup
        Volumes:
          - '/etc/localtime:/etc/localtime:ro'
          - '/var/run/docker.sock:/var/run/docker.sock'
          - '/var/lib/docker:/var/lib/docker'
        Environment:
          KEEP_IMAGES: traefik
      shepherd:
        mode: global
        Image: mazzolino/shepherd
        Environment:
          BLACKLIST_SERVICES: 'media_plex emby_emby'
          SLEEP_TIME: 86400
        Volumes:
          - '/var/run/docker.sock:/var/run/docker.sock:ro'
        manager: true
      portainer:
        mode: global
        Image: portainer/portainer
        proxy_secrets: true
        Environment:
          OAUTH2_PROXY_CLIENT_ID: /run/service/portainer_proxy_client_id
          OAUTH2_PROXY_CLIENT_SECRET: /run/service/portainer_proxy_client_secret
          OAUTH2_PROXY_COOKIE_SECRET: /run/service/portainer_proxy_cookie_secret
        ports:
          - '9000:9000'
        Volumes:
          - '/etc/localtime:/etc/localtime:ro'
          - 'portainer:/data'
          - '/var/run/docker.sock:/var/run/docker.sock'
          - 'portainer:/config'
        subdomains: docker
        networks:
          frontend: true
      organizr:
        mode: replicated
        OAUTH_PROXY: true
        Image: organizrtools/organizr-v2
        proxy_secrets: true
        Volumes:
          - '/etc/localtime:/etc/localtime:ro'
          - '/var/run/docker.sock:/var/run/docker.sock'
          - 'organizr:/data'
          - 'organizr:/config'
        ports:
          - '9999:80'
        networks:
          - frontend
        subdomains: home
        Environment:
          OAUTH2_PROXY_CLIENT_ID: /run/secrets/organizr_proxy_client_id
          OAUTH2_PROXY_CLIENT_SECRET: /run/secrets/organizr_proxy_client_secret
          OAUTH2_PROXY_COOKIE_SECRET: /run/secrets/organizr_proxy_cookie_secret
          UMASK: '000'
  Traefik:
    Secrets:
      godaddy_api_key:
        file: '${SECRETS}/traefik/godaddy_api_key.secret'
      godaddy_api_secret:
        file: '${SECRETS}/traefik/godaddy_api_secret.secret'
    Services:
      Traefik:
        configs:
           traefik_acme_json:
               Source:       ${CONFIGS}/traefik/acme.json
               Mask:         600
               Target:       /acme.json
           traefik_toml:
               Source:       ${CONFIGS}/traefik/traefik.toml
               Mask:         600
               Target:       /traefik.toml
           traefik_log:
               Source:       ${LOGS}/traefik.log
               Mask:         600
               Target:       /traefik.log
        mode: global
        secrets:
          - godaddy_api_secret
          - godaddy_api_key
        tags: v1.7.18-alpine
        Image: traefik
        manager: true
        networks:
          frontend: true
        Volumes:
          - '/etc/localtime:/etc/localtime:ro'
          - '${CONFIGS}/traefik/acme.json:/acme.json'
          - '${CONFIGS}/traefik/traefik.toml:/traefik.toml'
          - '${LOGS}/traefik.log:/traefik.log'
          - '/var/run/docker.sock:/var/run/docker.sock:ro'
        Commands:
          - '--web'
          - '--docker'
          - '--docker.swarmmode'
          - '--docker.watch'
          - '--docker.domain=expectedbehaviors.com'
          - '--logLevel=DEBUG'
        Ports:
          - '80:80'
          - '443:443'
          - '8080:8080'
        Environment:
          GODADDY_API_KEY: /run/secrets/godaddy_api_key
          GODADDY_API_SECRET: /run/secrets/godaddy_api_secret
          TAG: v1.7.18-alpine
  Usenet:
    Volumes:
      - downloads
    Services:
      nzbget:
        configs:
           nzbget_conf:
              Source:       ${CONFIGS}/usenet/nzbget.conf
              Target:       /config/nzbget.conf
              Mask:         644
           nzbget_log:
              Source:       ${LOGS}/nzbget.log
              Mask:         644
              Target:       /config/nzbget.log
        mode: replicated
        Image: linuxserver/nzbget
        proxy_secrets: true
        Environment:
          OAUTH2_PROXY_CLIENT_ID: /run/secrets/nzbget_proxy_client_id
          OAUTH2_PROXY_CLIENT_SECRET: /run/secrets/nzbget_proxy_client_secret
          OAUTH2_PROXY_COOKIE_SECRET: /run/secrets/nzbget_proxy_cookie_secret
          UMASK: '000'
        subdomains: news
        Volumes:
          - 'downloads:/downloads'
          - '/etc/localtime:/etc/localtime:ro'
          - '${CONFIGS}/usenet/nzbget.conf:/config/nzbget.conf'
          - '${LOGS}/nzbget.log:/config/nzbget.log'
        ports:
          - '6789:6789'
        networks:
          frontend: true
          vpn: true
  'Plex Companion Scripts':
    Secrets:
      plex_api_key:
        file: /var/lib/docker/config/secrets/plex/PLEX_API_KEY.secret
      radarr_api_key:
        file: /var/lib/docker/config/secrets/radarr/RADARR_API_KEY.secret
      sonarr_api_key:
        file: /var/lib/docker/config/secrets/sonarr/SONARR_API_KEY.secret
    Volumes:
      - media
      - plex_linker
    Services:
      plex_linker:
        Environment:
          APPEND_TO_CRON_END: "&& curl -fsS --retry 3 https://hc-ping.com/979ee9e7-bb7b-4627-9a8c-1722c53bcc67 > /dev/null"
          BACKEND_IP: 172.25.250.35
          CONFIG_ARCHIVES: /config/config_files/archives
          DOCKER_MEDIA_PATH: /media/video
          FREQUENCY: 5
          GIT_BRANCH: develop-docker-prototype
          GIT_REPO: 'https://github.com/jd4883/plex-linker-beta.git'
          PLEX_LINKER: /config
          RADARR_DEFAULT_ROOT: movies/staging
          RADARR_URL: 'http://172.28.254.26:7878/api'
          SONARR_DEFAULT_ROOT: tv/staging
          SONARR_ROOT_PATH_PREFIX: /data/
          SONARR_URL: 'http://172.28.254.26:8989/api'
        Image: jb6magic/plex_linker
        networks:
          frontend: false
        secrets:
          - plex_api_key
          - radarr_api_key
          - sonarr_api_key
        Volumes:
          - '/etc/localtime:/etc/localtime:ro'
          - 'media:/media'
          - 'plex_linker:/config'
  Torrents:
    Volumes:
      - deluge
      - rtorrent
      - jackett
      - shared
      - downloads
    Services:
      rtorrent:
        Environment:
          OAUTH2_PROXY_CLIENT_ID: /run/secrets/rtorrent_proxy_client_id
          OAUTH2_PROXY_CLIENT_SECRET: /run/secrets/rtorrent_proxy_client_secret
          OAUTH2_PROXY_COOKIE_SECRET: /run/secrets/rtorrent_proxy_cookie_secret
          VPN_ENABLED: no
          VPN_USER: p8543970
          VPN_PASS: YqheUCMj8XtSXtMaPE4ZvmyMReZjJ6RTKxqkAfGejswr3vRmPsYW86yKyyEv4ttev6jDF6YyxUaUyQzTreE6bFQYJct8m4qBVjkc
          VPN_PROV: pia
          STRICT_PORT_FORWARD: yes
          LAN_NETWORK: 172.28.254.0/26
          NAME_SERVERS: '209.222.18.222,37.235.1.174,1.1.1.1,8.8.8.8,209.222.18.218,37.235.1.177,1.0.0.1,8.8.4.4'
          DEBUG: true
          UMASK: '000'
          ENABLE_PRIVOXY: yes
          PHP_TZ: UTC
          ENABLE_AUTODL_IRSSI: yes
          ENABLE_RPC2: yes
          ENABLE_RPC2_AUTH: yes
        mode: replicated
        Image: linuxserver/rutorrent
        subdomains: downloads
        ports:
          - '9080:9080'
          - '9443:9443'
          - '8118:8118'
        networks:
          frontend: false
          vpn: true
        OAUTH_PROXY: true
        proxy_secrets: true
        Volumes:
          - 'downloads:/media'
          - 'downloads:/downloads'
          - 'rtorrent:/config'
      jackett:
        Environment:
          OAUTH2_PROXY_CLIENT_ID: /run/secrets/jackett_proxy_client_id
          OAUTH2_PROXY_CLIENT_SECRET: /run/secrets/jackett_proxy_client_secret
          OAUTH2_PROXY_COOKIE_SECRET: /run/secrets/jackett_proxy_cookie_secret
          UMASK: '000'
        mode: replicated
        Image: linuxserver/jackett
        subdomains: jackett
        ports:
          - '9117:9117'
        networks:
          frontend: false
          vpn: true
        OAUTH_PROXY: true
        proxy_secrets: true
        Volumes:
          - '/etc/localtime:/etc/localtime:ro'
          - 'jackett:/config'
          - 'downloads:/downloads'
  Media:
    Secrets:
      plex_claim:
        file: '${SECRETS}/plex/PLEX_CLAIM.secret'
      ombi_api_key:
        file: '${SECRETS}/ombi/OMBI_API_KEY.secret'
      plex_api_key:
        file: '${SECRETS}/plex/PLEX_API_KEY.secret'
      radarr_api_key:
        file: '${SECRETS}/radarr/RADARR_API_KEY.secret'
      lidarr_api_key:
        file: '${SECRETS}/lidarr/LIDARR_API_KEY.secret'
      sonarr_api_key:
        file: '${SECRETS}/sonarr/SONARR_API_KEY.secret'
      tautulli_api_key:
        file: '${SECRETS}/tautulli/TAUTULLI_API_KEY.secret'
    Volumes:
      - media
      - ombi
      - plex
      - plex-transcode
      - plex-logs
      - tautulli
    Services:
      plex:
        Environment:
          PLEX_CLAIM: /run/secrets/plex_claim
          TRANS_DIR: /transcode
          ADVERTISE_IP: 'http:/172.28.254.26:32400/'
          ALLOWED_NETWORKS: 172.28.254.0/26
          UMASK: '000'
        configs:
           plex_preferences_xml:
             Source:   ${CONFIGS}/media/plex/Preferences.xml
             Target:   /config/Plex Media Server/Preferences.xml
             Mask:     644
        secrets:
          - plex_api_key
          - plex_claim
          - radarr_api_key
          - sonarr_api_key
          - lidarr_api_key
        mode: replicated
        Image: binhex/arch-plexpass
        subdomains: plex
        ports:
          - '32400:32400/tcp'
          - '33400:33400/tcp'
          - '3005:3005/tcp'
          - '8324:8324/tcp'
          - '32469:32469/tcp'
          - '1900:1900/udp'
          - '32410:32410/udp'
          - '32412:32412/udp'
          - '32413:32413/udp'
          - '32414:32414/udp'
        networks:
          frontend: true
        Volumes:
          - '${CONFIGS}/media/plex/Preferences.xml:/config/Plex Media Server/Preferences.xml'
          - 'media:/media'
          - 'plex:/config'
          - 'plex-transcode:/transcode'
          - '/etc/localtime:/etc/localtime:ro'
      ombi:
        Environment:
          UMASK: '000'
          PLEX_CLAIM: /run/secrets/plex_claim
          PLEX_API_KEY: /run/secrets/plex_api_key
          RADARR_API_KEY: /run/secrets/radarr_api_key
          SONARR_API_KEY: /run/secrets/sonarr_api_key
          LIDARR_API_KEY: /run/secrets/lidarr_api_key
          OMBI_API_KEY: /run/secrets/ombi_api_key
        secrets:
          - plex_claim
          - ombi_api_key
          - plex_api_key
          - lidarr_api_key
          - sonarr_api_key
          - radarr_api_key
        mode: replicated
        Image: linuxserver/ombi
        subdomains: requests
        ports:
          - '3579:3579'
        networks:
          frontend: true
        Volumes:
          - 'ombi:/config'
          - '/etc/localtime:/etc/localtime:ro'
      tautulli:
        Environment:
          UMASK: '000'
          OAUTH2_PROXY_CLIENT_ID: /run/secrets/tautulli_client_id
          OAUTH2_PROXY_CLIENT_SECRET: /run/secrets/tautulli_client_secret
          OAUTH2_PROXY_COOKIE_SECRET: /run/secrets/tautulli_cookie_secret
          PLEX_CLAIM: /run/secrets/plex_claim
          PLEX_API_KEY: /run/secrets/plex_api_key
          RADARR_API_KEY: /run/secrets/radarr_api_key
          SONARR_API_KEY: /run/secrets/sonarr_api_key
          LIDARR_API_KEY: /run/secrets/lidarr_api_key
          TAUTULLI_API_KEY: /run/secrets/tautulli_api_key
        secrets:
          - plex_claim
          - tautulli_api_key
          - plex_api_key
          - lidarr_api_key
          - sonarr_api_key
          - radarr_api_key
        mode: replicated
        Image: linuxserver/tautulli
        subdomains: statistics
        ports:
          - '8181:8181'
        networks:
          frontend: true
        OAUTH_PROXY: true
        proxy_secrets: true
        Volumes:
          - 'tautulli:/config'
          - 'plex-logs:/logs:ro'
  Aggregators:
    Volumes:
      - downloads
      - nzbhydra2
      - pubhydra2
    Services:
      nzbhydra2:
        Environment:
          OAUTH2_PROXY_CLIENT_ID: /run/secrets/nzbhydra2_proxy_client_id
          OAUTH2_PROXY_CLIENT_SECRET: /run/secrets/nzbhydra2_proxy_client_secret
          OAUTH2_PROXY_COOKIE_SECRET: /run/secrets/nzbhydra2_proxy_cookie_secret
          UMASK: '000'
        mode: replicated
        Image: linuxserver/hydra2
        subdomains: hydra
        ports:
          - '5076:5076'
        networks:
          frontend: false
          vpn: true
        OAUTH_PROXY: true
        proxy_secrets: true
        Volumes:
          - 'downloads:/downloads'
          - 'nzbhydra2:/config'
          - 'nzbhydra2:/data'
          - '/etc/environment:/etc/environment:ro'
      # pubhydra2:
      #     Environment:
      #       OAUTH2_PROXY_CLIENT_ID:       /run/secrets/pubhydra2_proxy_client_id
      #       OAUTH2_PROXY_CLIENT_SECRET:   /run/secrets/pubhydra2_proxy_client_secret
      #       OAUTH2_PROXY_COOKIE_SECRET:   /run/secrets/pubhydra2_proxy_cookie_secret
      #       UMASK:                        '000'
      #     mode:                            replicated
      #     Image:                           linuxserver/hydra2
      #     subdomains:                      pubhydra
      #     ports:
      #       - 5077:5077
      #     networks:
      #       frontend:                      False
      #       vpn:                           True
      #     OAUTH_PROXY:                     True
      #     proxy_secrets:                   True
      #     Volumes:
      #       - downloads:/downloads
      #       - pubhydra2:/config
      #       - pubhydra2:/data
      #       - /etc/environment:/etc/environment:ro
  Grabbers:
    Secrets:
      sonarr_api_key:
        file: /var/lib/docker/config/secrets/sonarr/SONARR_API_KEY.secret
      lidarr_api_key:
        file: /var/lib/docker/config/secrets/lidarr/LIDARR_API_KEY.secret
      radarr_api_key:
        file: /var/lib/docker/config/secrets/rdarr/RADARR_API_KEY.secret
      mylar_api_key:
        file: /var/lib/docker/config/secrets/rdarr/MYLAR_API_KEY.secret
      lazylibrarian_api_key:
        file: /var/lib/docker/config/secrets/rdarr/LAZYLIBRARIAN_API_KEY.secret
      bazarr_api_key:
        file: /var/lib/docker/config/secrets/rdarr/BAZARR_API_KEY.secret
    Volumes:
      - media
      - media-movies
      - media-tv
      - media-anime
      - media-music
      - media-magazines
      - media-epub
      - media-comics
      - media-audiobooks
      - media-pdf
      - shared
      - downloads
      - sonarr
      - lidarr
      - mylar
      - radarr
      - lazylibrarian
      - bazarr
    Services:
      sonarr:
        configs:
           sonarr_config_xml:
               Source:       ${CONFIGS}/sonarr/sonarr.xml
               Mask:         644
               Target:       /config/config.xml
        Environment:
          OAUTH2_PROXY_CLIENT_ID:     /run/secrets/sonarr_proxy_client_id
          OAUTH2_PROXY_CLIENT_SECRET: /run/secrets/sonarr_proxy_client_secret
          OAUTH2_PROXY_COOKIE_SECRET: /run/secrets/sonarr_proxy_cookie_secret
          SONARR_API_KEY:             /run/secrets/sonarr_api_key
        secrets:
          -         sonarr_api_key
        tags:       preview
        mode:       replicated
        Image:      linuxserver/sonarr
        subdomains: tv
        ports:
          - '8989:8989'
        networks:
          frontend: false
          vpn: true
        OAUTH_PROXY: true
        proxy_secrets: true
        Volumes:
            - /etc/localtime:/etc/localtime:ro
            - sonarr:/config
            - media:/media
            - media-tv:/data/tv
            - media-tv:/tv
            - media-anime:/data/anime
            - downloads:/downloads
            - ${CONFIGS}/sonarr/sonarr.xml:/config/config.xml
      bazarr:
        Environment:
          OAUTH2_PROXY_CLIENT_ID:     /run/secrets/bazarr_proxy_client_id
          OAUTH2_PROXY_CLIENT_SECRET: /run/secrets/bazarr_proxy_client_secret
          OAUTH2_PROXY_COOKIE_SECRET: /run/secrets/bazarr_proxy_cookie_secret
          BAZARR_API_KEY:             /run/secrets/bazarr_api_key
        secrets:
          -         bazarr_api_key
        mode:       replicated
        Image:      linuxserver/bazarr
        subdomains: subs
        ports:
          - '6767:6767'
        networks:
          frontend: false
          vpn: true
        OAUTH_PROXY: true
        proxy_secrets: true
        Volumes:
            - bazarr:/config
            - media-movies:/movies
            - media-tv:/tv
            - media-anime:/anime
      lazylibrarian:
        Environment:
          OAUTH2_PROXY_CLIENT_ID:     /run/secrets/lazylibrarian_proxy_client_id
          OAUTH2_PROXY_CLIENT_SECRET: /run/secrets/lazylibrarian_proxy_client_secret
          OAUTH2_PROXY_COOKIE_SECRET: /run/secrets/lazylibrarian_proxy_cookie_secret
          LAZYLIBRARIAN_API_KEY:      /run/secrets/lazylibrarian_api_key
          UMASK: '022'
        secrets:
          -         lazylibrarian_api_key
        mode:       replicated
        Image:      linuxserver/lazylibrarian
        subdomains: subs
        ports:
          - '5299:5299'
        networks:
          frontend: false
          vpn: true
        OAUTH_PROXY: False
        proxy_secrets: true
        Volumes:
            - lazylibrarian:/config
            - downloads:/downloads
            - media:/media
            - media-epub:/books
            - media-magazines:/magazines
            - media-comics:/comics
            - media-audiobooks:/audiobooks
      mylar:
        Environment:
          OAUTH2_PROXY_CLIENT_ID:     /run/secrets/mylar_proxy_client_id
          OAUTH2_PROXY_CLIENT_SECRET: /run/secrets/mylar_proxy_client_secret
          OAUTH2_PROXY_COOKIE_SECRET: /run/secrets/mylar_proxy_cookie_secret
          MYLAR_API_KEY:              /run/secrets/mylar_api_key
        secrets:
          -         mylar_api_key
        mode:       replicated
        Image:      linuxserver/mylar
        subdomains: comics
        ports:
          - '8090:8090'
        networks:
          frontend: true
          vpn: true
        OAUTH_PROXY: False
        proxy_secrets: true
        Volumes:
            - /etc/localtime:/etc/localtime:ro
            - mylar:/config
            - downloads:/downloads
            - media-comics:/comics
      lidarr:
        Environment:
          OAUTH2_PROXY_CLIENT_ID:     /run/secrets/lidarr_proxy_client_id
          OAUTH2_PROXY_CLIENT_SECRET: /run/secrets/lidarr_proxy_client_secret
          OAUTH2_PROXY_COOKIE_SECRET: /run/secrets/lidarr_proxy_cookie_secret
          LIDARR_API_KEY:             /run/secrets/lidarr_api_key
        secrets:
          -         lidarr_api_key
        tags:       preview
        mode:       replicated
        Image:      linuxserver/lidarr
        subdomains: music
        ports:
          - '8686:8686'
        networks:
          frontend: false
          vpn: true
        OAUTH_PROXY: true
        proxy_secrets: true
        Volumes:
            - /etc/localtime:/etc/localtime:ro
            - lidarr:/config
            - media-music:/music
            - downloads:/downloads
            - ${CONFIGS}/lidarr/lidarr.xml:/config/config.xml
      radarr:
        Environment:
          OAUTH2_PROXY_CLIENT_ID:     /run/secrets/radarr_proxy_client_id
          OAUTH2_PROXY_CLIENT_SECRET: /run/secrets/radarr_proxy_client_secret
          OAUTH2_PROXY_COOKIE_SECRET: /run/secrets/radarr_proxy_cookie_secret
          RADARR_API_KEY:             /run/secrets/radarr_api_key
        secrets:
          -         radarr_api_key
        tags:       preview
        mode:       replicated
        Image:      linuxserver/radarr
        subdomains: movies
        ports:
          - '7878:7878'
        networks:
          frontend: false
          vpn: true
        OAUTH_PROXY: true
        proxy_secrets: true
        Volumes:
            - /etc/localtime:/etc/localtime:ro
            - radarr:/config
            - media-movies:/movies
            - downloads:/downloads
            - ${CONFIGS}/radarr/radarr.xml:/config/config.xml
